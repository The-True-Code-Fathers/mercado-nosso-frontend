<header class="header">
  <!-- Top Bar -->
  <div class="header-top">
    <div class="header-top-container">
      <div class="top-left">
        <span class="delivery-info">
          <i class="pi pi-map-marker"></i>
          Entregamos para toda São Paulo
        </span>
      </div>
      <div class="top-right">
        @if (username) {
          <span class="user-greeting">Bem vindo de volta, {{ username }}!</span>
        } @else {
          <span class="user-greeting">Bem vido ao mercado nosso!</span>
        }
      </div>
    </div>
  </div>

  <!-- Main Header -->
  <div class="header-main">
    <div class="header-container">
      <!-- Logo/Brand -->
      <div class="brand" routerLink="/home">
        <i class="pi pi-shopping-bag brand-icon"></i>
        <span class="brand-text">Mercado Nosso</span>
      </div>

      <!-- Desktop Navigation -->
      <div class="desktop-nav">
        <!-- Search Bar - More prominent -->
        <div class="search-container">
          <div class="search-wrapper">
            <p-iconField iconPosition="left" class="search-field">
              <input
                type="text"
                pInputText
                placeholder="O que você procura?"
                [(ngModel)]="searchTerm"
                (keyup.enter)="onSearch()"
                class="search-input"
              />
            </p-iconField>
            <p-button
              icon="pi pi-search"
              styleClass="p-button-success search-button"
              (click)="onSearch()"
              pTooltip="Buscar">
            </p-button>
          </div>
        </div>
      </div>

      <!-- User Actions -->
      <div class="user-actions desktop-only">
        <!-- Categories Button -->
        <div class="categories-container">
          <p-button
            label="Venda conosco"
            icon="pi pi-shop"
            styleClass="p-button-outlined categories-button"
            [attr.aria-expanded]="categoriesMenuVisible"
            [attr.aria-haspopup]="true" />
        </div>

        <div class="action-separator"></div>

        <div class="cart-container">
          <p-button
            icon="pi pi-shopping-cart"
            styleClass="p-button-text p-button-rounded cart-action"
            pTooltip="Meu Carrinho"
            routerLink="/cart">
          </p-button>
          <p-badge
            *ngIf="cartItemsCount > 0"
            [value]="cartItemsCount.toString()"
            severity="danger"
            class="cart-badge">
          </p-badge>
        </div>

        <p-button
          icon="pi pi-user"
          styleClass="p-button-text p-button-rounded user-action"
          pTooltip="Minha Conta"
          routerLink="/user">
        </p-button>

        <p-button
          [icon]="isDarkMode ? 'pi pi-sun' : 'pi pi-moon'"
          styleClass="p-button-text p-button-rounded theme-action"
          [pTooltip]="isDarkMode ? 'Modo Claro' : 'Modo Escuro'"
          (click)="toggleTheme()">
        </p-button>
      </div>
    </div>
      <div class="quick-categories">
        <div class="all-categories-container">
          <span class="category-link all-categories-trigger" 
                (click)="toggleCategoriesMegaMenu()"
                [attr.aria-expanded]="categoriesMegaMenuVisible">
            <i class="pi pi-bars"></i>
            Todas as categorias
          </span>
          
          <div *ngIf="categoriesMegaMenuVisible" 
               class="categories-overlay" 
               (click)="closeCategoriesMegaMenu()">
          </div>
          
          <div *ngIf="categoriesMegaMenuVisible" 
               class="categories-megamenu-custom">
            <div class="megamenu-header">
              <h3>Todas as Categorias</h3>
              <button class="close-button" (click)="closeCategoriesMegaMenu()">
                <i class="pi pi-times"></i>
              </button>
            </div>
            <div class="categories-grid">
              <a *ngFor="let category of categories" 
                 [routerLink]="['/products']" 
                 [queryParams]="{category: category.key}"
                 class="category-item"
                 (click)="onCategorySelected()">
                <i [class]="category.icon"></i>
                <span>{{ category.label }}</span>
              </a>
            </div>
          </div>
        </div>
        
        <span class="category-link" *ngFor="let category of quickCategories"
              [routerLink]="['/products']" [queryParams]="{category: category.key}">
          {{ category.label }}
        </span>
      </div>
  </div>

  <!-- Mobile Menu Button -->
  <div class="mobile-menu-button">
    <p-button
      icon="pi pi-bars"
      styleClass="p-button-text p-button-rounded"
      (click)="toggleMobileMenu()"
      [attr.aria-expanded]="mobileMenuVisible">
    </p-button>
  </div>

  <!-- Mobile Menu -->
  <div class="mobile-menu" [class.mobile-menu-active]="mobileMenuVisible">
    <div class="mobile-search">
      <div class="mobile-search-wrapper">
        <p-iconField iconPosition="left" class="mobile-search-field">
          <p-inputIcon styleClass="pi pi-search"></p-inputIcon>
          <input
            type="text"
            pInputText
            placeholder="O que você está procurando?"
            [(ngModel)]="searchTerm"
            (keyup.enter)="onSearch()"
            class="search-input"
          />
        </p-iconField>
        <p-button
          icon="pi pi-search"
          styleClass="p-button-success mobile-search-button"
          (click)="onSearch()">
        </p-button>
      </div>
    </div>

    <div class="mobile-categories">
      <p-button
        label="Todas as Categorias"
        icon="pi pi-angle-down"
        styleClass="p-button-outlined mobile-categories-button"
        (click)="toggleMobileCategoriesMenu()"
        [attr.aria-expanded]="mobileCategoriesVisible">
      </p-button>

      <div class="mobile-categories-menu" [class.mobile-categories-active]="mobileCategoriesVisible">
        <div class="category-item" *ngFor="let category of categories">
          <a [routerLink]="['/products']" [queryParams]="{category: category.key}" (click)="closeMobileMenu()">
            <i [class]="category.icon"></i>
            <span>{{ category.label }}</span>
          </a>
        </div>
      </div>
    </div>

    <div class="mobile-actions">
      <div class="mobile-action-item">
        <div class="mobile-cart-container">
          <p-button
            icon="pi pi-shopping-cart"
            label="Meu Carrinho"
            styleClass="p-button-outlined mobile-action-button"
            routerLink="/cart"
            (click)="closeMobileMenu()">
          </p-button>
          <p-badge
            *ngIf="cartItemsCount > 0"
            [value]="cartItemsCount.toString()"
            severity="danger"
            class="mobile-cart-badge">
          </p-badge>
        </div>
      </div>

      <div class="mobile-action-item">
        <p-button
          icon="pi pi-user"
          label="Minha Conta"
          styleClass="p-button-outlined mobile-action-button"
          routerLink="/user"
          (click)="closeMobileMenu()">
        </p-button>
      </div>

      <div class="mobile-action-item">
        <p-button
          [icon]="isDarkMode ? 'pi pi-sun' : 'pi pi-moon'"
          [label]="isDarkMode ? 'Modo Claro' : 'Modo Escuro'"
          styleClass="p-button-outlined mobile-action-button"
          (click)="toggleTheme(); closeMobileMenu()">
        </p-button>
      </div>
    </div>
  </div>
</header>
